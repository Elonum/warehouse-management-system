# Database Migrations

## Что такое миграции?

**Миграции БД** - это версионированные SQL скрипты, которые управляют изменениями структуры базы данных.

### Зачем они нужны?

1. **Версионирование схемы БД** - отслеживание всех изменений структуры БД
2. **Последовательное применение** - миграции применяются в определенном порядке
3. **Откат изменений** - возможность откатить миграции при необходимости
4. **Работа в команде** - все разработчики имеют одинаковую структуру БД
5. **Production deployment** - автоматическое применение изменений при деплое

### Как это работает?

1. Миграции хранятся в директории `migrations/`
2. Имена файлов имеют формат: `{версия}_{название}.up.sql` и `{версия}_{название}.down.sql`
   - `.up.sql` - применяет изменения
   - `.down.sql` - откатывает изменения
3. При запуске приложения миграции применяются автоматически

### Пример структуры:

```
migrations/
├── 000001_create_users.up.sql
├── 000001_create_users.down.sql
├── 000002_create_products.up.sql
└── 000002_create_products.down.sql
```

### Использование:

Миграции запускаются автоматически при старте приложения (см. `cmd/api/main.go`).

Если вы хотите управлять миграциями вручную, используйте CLI инструмент `migrate`:

```bash
# Установка
go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@latest

# Применить миграции
migrate -path migrations -database "postgres://user:pass@localhost/dbname?sslmode=disable" up

# Откатить последнюю миграцию
migrate -path migrations -database "postgres://user:pass@localhost/dbname?sslmode=disable" down 1
```

### Важно:

- **НЕ изменяйте существующие миграции** после их применения в production
- Создавайте новые миграции для изменений
- Всегда тестируйте миграции на тестовой БД перед применением в production

