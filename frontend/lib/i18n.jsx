import { createContext, useContext, useState, useEffect } from 'react';

const translations = {
  ru: {
    common: {
      loading: 'Загрузка...',
      save: 'Сохранить',
      cancel: 'Отмена',
      delete: 'Удалить',
      edit: 'Редактировать',
      create: 'Создать',
      add: 'Добавить',
      close: 'Закрыть',
      search: 'Поиск',
      actions: 'Действия',
      yes: 'Да',
      no: 'Нет',
      confirm: 'Подтвердить',
      back: 'Назад',
      next: 'Далее',
      submit: 'Отправить',
      reset: 'Сбросить',
      update: 'Обновить',
      all: 'Все',
      details: 'Детали',
      history: 'История',
      deleting: 'Удаление...',
      notSpecified: 'Не указан',
      noData: 'Нет данных',
    },
    layout: {
      appName: 'WareFlow',
      appDescription: 'Управление складом',
      settings: 'Настройки',
    },
    nav: {
      dashboard: 'Панель управления',
      products: 'Товары',
      warehouses: 'Склады',
      stock: 'Остатки',
      stockMovements: 'Движения товаров',
      supplierOrders: 'Заказы поставщикам',
      shipments: 'Отгрузки',
      inventoryAdjustments: 'Инвентаризация',
      productCosts: 'Себестоимость',
      usersRoles: 'Пользователи',
      referenceData: 'Справочники',
    },
    referenceData: {
      title: 'Справочники',
      description: 'Управление справочными данными системы',
      roles: {
        title: 'Роли пользователей',
        description: 'Управление ролями и правами доступа',
      },
      orderStatuses: {
        title: 'Статусы заказов',
        description: 'Настройка статусов заказов поставщикам',
      },
      shipmentStatuses: {
        title: 'Статусы отгрузок',
        description: 'Настройка статусов отгрузок на маркетплейсы',
      },
      inventoryStatuses: {
        title: 'Статусы инвентаризаций',
        description: 'Настройка статусов инвентаризаций',
      },
      warehouseTypes: {
        title: 'Типы складов',
        description: 'Управление типами складских помещений',
      },
      items: 'Элементы',
      moreItems: 'и еще {count}',
      empty: 'Нет данных',
      manage: 'Управление',
      summary: {
        title: 'Сводка справочников',
        description: 'Общее количество элементов в справочниках',
      },
    },
    dashboard: {
      title: 'Панель управления',
      description: 'Обзор складских операций',
      stats: {
        totalStock: 'Остатки (всего)',
        totalProducts: 'Всего товаров',
        activeOrders: 'Активных заказов',
        activeShipments: 'Активных отгрузок',
      },
      charts: {
        stockByWarehouse: 'Остатки по складам (шт.)',
        ordersByStatus: 'Заказы по статусам',
        recentMovements: 'Последние изменения остатков',
        recentOrders: 'Последние заказы',
      },
      product: 'Товар',
      warehouse: 'Склад',
      stock: 'Остаток',
      movements: 'Нет движений',
      orders: 'Нет заказов',
    },
    products: {
      title: 'Товары',
      description: 'Управление каталогом товаров',
      addProduct: 'Добавить товар',
      editProduct: 'Редактировать товар',
      searchPlaceholder: 'Поиск товаров...',
      emptyMessage: 'Товары не найдены',
      table: {
        article: 'Артикул',
        barcode: 'Баркод',
        weight: 'Вес (г)',
        price: 'Цена',
        stock: 'Остатки',
      },
      form: {
        article: 'Артикул',
        barcode: 'Баркод',
        weight: 'Вес (г)',
        price: 'Цена (₽)',
        articleRequired: 'Артикул обязателен для заполнения',
        barcodeRequired: 'Баркод обязателен для заполнения',
      },
      deleteConfirm: {
        title: 'Удалить товар',
        description: 'Вы уверены, что хотите удалить товар "{article}"? Это действие невозможно отменить.',
      },
      errors: {
        createFailed: 'Ошибка создания товара',
        updateFailed: 'Ошибка обновления товара',
        deleteFailed: 'Ошибка удаления товара',
      },
    },
    warehouses: {
      title: 'Склады',
      description: 'Управление складами и магазинами',
      tabs: {
        warehouses: 'Склады',
        stores: 'Магазины',
      },
      addWarehouse: 'Добавить склад',
      editWarehouse: 'Редактировать склад',
      addStore: 'Добавить магазин',
      editStore: 'Редактировать магазин',
      searchPlaceholder: 'Поиск складов...',
      emptyMessage: 'Склады не найдены',
      table: {
        name: 'Название склада',
        type: 'Тип',
        location: 'Адрес',
      },
      form: {
        name: 'Название',
        type: 'Тип склада',
        location: 'Адрес',
        nameRequired: 'Название склада обязательно',
        storeNameRequired: 'Название магазина обязательно',
      },
      deleteConfirm: {
        title: 'Удалить',
        warehouseDescription: 'Вы уверены, что хотите удалить склад "{name}"?',
        storeDescription: 'Вы уверены, что хотите удалить магазин "{name}"?',
      },
      errors: {
        createFailed: 'Ошибка создания',
        updateFailed: 'Ошибка обновления',
        deleteFailed: 'Ошибка удаления',
      },
    },
    stock: {
      title: 'Остатки товаров',
      description: 'Текущие остатки товаров на складах',
      searchPlaceholder: 'Поиск остатков...',
      emptyMessage: 'Остатки не найдены',
      stats: {
        totalProducts: 'Всего товаров',
        positions: 'Позиций на складах',
      },
      filters: {
        title: 'Фильтры:',
        product: 'Товар',
        warehouse: 'Склад',
        clear: 'Очистить фильтры',
      },
      table: {
        product: 'Товар',
        warehouse: 'Склад',
        quantity: 'Количество',
      },
    },
    supplierOrders: {
      title: 'Заказы поставщикам',
      description: 'Управление заказами поставщикам',
      addOrder: 'Добавить заказ',
      editOrder: 'Редактировать заказ',
      createSubOrder: 'Создать подзаказ',
      searchPlaceholder: 'Поиск заказов...',
      emptyMessage: 'Заказы не найдены',
      subOrder: 'Подзаказ',
      table: {
        orderNumber: 'Номер заказа',
        buyer: 'Покупатель',
        status: 'Статус',
        purchaseDate: 'Дата покупки',
        plannedReceipt: 'План. поступление',
        actualReceipt: 'Факт. поступление',
        cost: 'Стоимость',
        positions: 'Позиций',
        quantity: 'Количество',
      },
      form: {
        orderNumber: 'Номер заказа',
        buyer: 'Покупатель',
        status: 'Статус',
        purchaseDate: 'Дата покупки',
        plannedReceiptDate: 'Плановая дата поступления',
        actualReceiptDate: 'Фактическая дата поступления',
        logisticsChinaMsk: 'Логистика Китай-МСК',
        logisticsMskKzn: 'Логистика МСК-КЗН',
        logisticsAdditional: 'Доп. логистика',
        logisticsTotal: 'Итого логистика',
        orderItemCost: 'Стоимость товаров',
        positionsQty: 'Количество позиций',
        totalQty: 'Общее количество',
        orderItemWeight: 'Вес товаров',
        orderNumberRequired: 'Номер заказа обязателен',
      },
      deleteConfirm: {
        title: 'Удалить заказ',
        description: 'Вы уверены, что хотите удалить заказ "{orderNumber}"?',
      },
      errors: {
        createFailed: 'Ошибка создания заказа',
        updateFailed: 'Ошибка обновления заказа',
        deleteFailed: 'Ошибка удаления заказа',
      },
    },
    shipments: {
      title: 'Отгрузки',
      description: 'Управление отгрузками на маркетплейсы',
      addShipment: 'Добавить отгрузку',
      editShipment: 'Редактировать отгрузку',
      searchPlaceholder: 'Поиск отгрузок...',
      emptyMessage: 'Отгрузки не найдены',
      table: {
        shipmentNumber: 'Номер отгрузки',
        store: 'Магазин',
        warehouse: 'Склад',
        status: 'Статус',
        shipmentDate: 'Дата отгрузки',
        sentAccepted: 'Отправлено / Принято',
        logistics: 'Логистика',
      },
      form: {
        shipmentNumber: 'Номер отгрузки',
        store: 'Магазин',
        warehouse: 'Склад',
        status: 'Статус',
        shipmentDate: 'Дата отгрузки',
        acceptanceDate: 'Дата приемки',
        logisticsCost: 'Стоимость логистики',
        unitLogistics: 'Логистика на единицу',
        acceptanceCost: 'Стоимость приемки',
        positionsQty: 'Количество позиций',
        sentQty: 'Отправлено',
        acceptedQty: 'Принято',
      },
      deleteConfirm: {
        title: 'Удалить отгрузку',
        description: 'Вы уверены, что хотите удалить отгрузку "{shipmentNumber}"?',
      },
      errors: {
        createFailed: 'Ошибка создания отгрузки',
        updateFailed: 'Ошибка обновления отгрузки',
        deleteFailed: 'Ошибка удаления отгрузки',
      },
    },
    inventoryAdjustments: {
      title: 'Инвентаризации',
      description: 'Управление инвентаризациями и корректировками остатков',
      addAdjustment: 'Новая инвентаризация',
      editAdjustment: 'Редактировать инвентаризацию',
      searchPlaceholder: 'Поиск инвентаризаций...',
      emptyMessage: 'Инвентаризации не найдены',
      table: {
        number: '№',
        adjustmentDate: 'Дата инвентаризации',
        status: 'Статус',
        receipt: 'Поступление',
        writeOff: 'Списание',
        notes: 'Примечания',
        createdAt: 'Создано',
      },
      form: {
        adjustmentDate: 'Дата инвентаризации',
        status: 'Статус',
        notes: 'Примечания',
      },
      deleteConfirm: {
        title: 'Удалить инвентаризацию',
        description: 'Вы уверены, что хотите удалить эту инвентаризацию? Это действие нельзя отменить.',
      },
      errors: {
        createFailed: 'Ошибка создания инвентаризации',
        updateFailed: 'Ошибка обновления инвентаризации',
        deleteFailed: 'Ошибка удаления инвентаризации',
      },
    },
    settings: {
      title: 'Настройки',
      user: {
        title: 'Информация о пользователе',
        email: 'Email',
        name: 'Имя',
        surname: 'Фамилия',
        role: 'Роль',
      },
      appearance: {
        title: 'Внешний вид',
        theme: 'Тема',
        themeLight: 'Светлая',
        themeDark: 'Темная',
        language: 'Язык',
        languageRu: 'Русский',
        languageEn: 'English',
      },
      notifications: {
        title: 'Уведомления',
        description: 'Показывать уведомления о важных событиях',
      },
      logout: 'Выход из аккаунта',
      logoutConfirm: 'Вы уверены, что хотите выйти?',
    },
    users: {
      title: 'Пользователи',
      description: 'Управление пользователями и ролями',
      addUser: 'Добавить пользователя',
      editUser: 'Редактировать пользователя',
      searchPlaceholder: 'Поиск пользователей...',
      emptyMessage: 'Пользователи не найдены',
      stats: {
        totalUsers: 'Всего пользователей',
        administrators: 'Администраторы',
        standardUsers: 'Обычные пользователи',
      },
      table: {
        user: 'Пользователь',
        role: 'Роль',
      },
      form: {
        email: 'Email',
        password: 'Пароль',
        passwordHint: 'Минимум 6 символов',
        passwordChangeHint: 'Оставьте пустым, чтобы не менять пароль',
        role: 'Роль',
        selectRole: 'Выберите роль',
        name: 'Имя',
        surname: 'Фамилия',
        patronymic: 'Отчество',
      },
      deleteConfirm: {
        title: 'Удалить пользователя',
        description: 'Вы уверены, что хотите удалить пользователя "{name}"? Это действие нельзя отменить.',
      },
      errors: {
        requiredFields: 'Заполните обязательные поля',
        passwordRequired: 'Пароль обязателен для нового пользователя',
        passwordMinLength: 'Пароль должен содержать минимум 6 символов',
        invalidEmail: 'Некорректный формат email',
        createFailed: 'Ошибка создания пользователя',
        updateFailed: 'Ошибка обновления пользователя',
        deleteFailed: 'Ошибка удаления пользователя',
      },
    },
  },
  en: {
    common: {
      loading: 'Loading...',
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      edit: 'Edit',
      create: 'Create',
      add: 'Add',
      close: 'Close',
      search: 'Search',
      actions: 'Actions',
      yes: 'Yes',
      no: 'No',
      confirm: 'Confirm',
      back: 'Back',
      next: 'Next',
      submit: 'Submit',
      reset: 'Reset',
      update: 'Update',
      all: 'All',
      details: 'Details',
      history: 'History',
      deleting: 'Deleting...',
      notSpecified: 'Not specified',
      noData: 'No data',
    },
    layout: {
      appName: 'WareFlow',
      appDescription: 'Warehouse Management',
      settings: 'Settings',
    },
    nav: {
      dashboard: 'Dashboard',
      products: 'Products',
      warehouses: 'Warehouses',
      stock: 'Stock',
      stockMovements: 'Stock Movements',
      supplierOrders: 'Supplier Orders',
      shipments: 'Shipments',
      inventoryAdjustments: 'Inventory Adjustments',
      productCosts: 'Product Costs',
      usersRoles: 'Users & Roles',
      referenceData: 'Reference Data',
    },
    referenceData: {
      title: 'Reference Data',
      description: 'Manage system reference data',
      roles: {
        title: 'User Roles',
        description: 'Manage user roles and access permissions',
      },
      orderStatuses: {
        title: 'Order Statuses',
        description: 'Configure supplier order statuses',
      },
      shipmentStatuses: {
        title: 'Shipment Statuses',
        description: 'Configure marketplace shipment statuses',
      },
      inventoryStatuses: {
        title: 'Inventory Statuses',
        description: 'Configure inventory adjustment statuses',
      },
      warehouseTypes: {
        title: 'Warehouse Types',
        description: 'Manage warehouse facility types',
      },
      items: 'Items',
      moreItems: 'and {count} more',
      empty: 'No data',
      manage: 'Manage',
      summary: {
        title: 'Reference Data Summary',
        description: 'Total number of items across all reference data',
      },
    },
    dashboard: {
      title: 'Dashboard',
      description: 'Warehouse operations overview',
      stats: {
        totalStock: 'Total Stock',
        totalProducts: 'Total Products',
        activeOrders: 'Active Orders',
        activeShipments: 'Active Shipments',
      },
      charts: {
        stockByWarehouse: 'Stock by Warehouses (units)',
        ordersByStatus: 'Orders by Status',
        recentMovements: 'Recent Stock Movements',
        recentOrders: 'Recent Orders',
      },
      product: 'Product',
      warehouse: 'Warehouse',
      stock: 'Stock',
      movements: 'No movements',
      orders: 'No orders',
    },
    products: {
      title: 'Products',
      description: 'Product catalog management',
      addProduct: 'Add Product',
      editProduct: 'Edit Product',
      searchPlaceholder: 'Search products...',
      emptyMessage: 'No products found',
      table: {
        article: 'Article',
        barcode: 'Barcode',
        weight: 'Weight (g)',
        price: 'Price',
        stock: 'Stock',
      },
      form: {
        article: 'Article',
        barcode: 'Barcode',
        weight: 'Weight (g)',
        price: 'Price (₽)',
        articleRequired: 'Article is required',
        barcodeRequired: 'Barcode is required',
      },
      deleteConfirm: {
        title: 'Delete Product',
        description: 'Are you sure you want to delete product "{article}"? This action cannot be undone.',
      },
      errors: {
        createFailed: 'Failed to create product',
        updateFailed: 'Failed to update product',
        deleteFailed: 'Failed to delete product',
      },
    },
    warehouses: {
      title: 'Warehouses',
      description: 'Warehouses and stores management',
      tabs: {
        warehouses: 'Warehouses',
        stores: 'Stores',
      },
      addWarehouse: 'Add Warehouse',
      editWarehouse: 'Edit Warehouse',
      addStore: 'Add Store',
      editStore: 'Edit Store',
      searchPlaceholder: 'Search warehouses...',
      emptyMessage: 'No warehouses found',
      table: {
        name: 'Warehouse Name',
        type: 'Type',
        location: 'Address',
      },
      form: {
        name: 'Name',
        type: 'Warehouse Type',
        location: 'Address',
        nameRequired: 'Warehouse name is required',
        storeNameRequired: 'Store name is required',
      },
      deleteConfirm: {
        title: 'Delete',
        warehouseDescription: 'Are you sure you want to delete warehouse "{name}"?',
        storeDescription: 'Are you sure you want to delete store "{name}"?',
      },
      errors: {
        createFailed: 'Failed to create',
        updateFailed: 'Failed to update',
        deleteFailed: 'Failed to delete',
      },
    },
    stock: {
      title: 'Stock',
      description: 'Current stock levels across warehouses',
      searchPlaceholder: 'Search stock...',
      emptyMessage: 'No stock found',
      stats: {
        totalProducts: 'Total Products',
        positions: 'Warehouse Positions',
      },
      filters: {
        title: 'Filters:',
        product: 'Product',
        warehouse: 'Warehouse',
        clear: 'Clear Filters',
      },
      table: {
        product: 'Product',
        warehouse: 'Warehouse',
        quantity: 'Quantity',
      },
    },
    supplierOrders: {
      title: 'Supplier Orders',
      description: 'Supplier order management',
      addOrder: 'Add Order',
      editOrder: 'Edit Order',
      createSubOrder: 'Create Sub-order',
      searchPlaceholder: 'Search orders...',
      emptyMessage: 'No orders found',
      subOrder: 'Sub-order',
      table: {
        orderNumber: 'Order Number',
        buyer: 'Buyer',
        status: 'Status',
        purchaseDate: 'Purchase Date',
        plannedReceipt: 'Planned Receipt',
        actualReceipt: 'Actual Receipt',
        cost: 'Cost',
        positions: 'Positions',
        quantity: 'Quantity',
      },
      form: {
        orderNumber: 'Order Number',
        buyer: 'Buyer',
        status: 'Status',
        purchaseDate: 'Purchase Date',
        plannedReceiptDate: 'Planned Receipt Date',
        actualReceiptDate: 'Actual Receipt Date',
        logisticsChinaMsk: 'Logistics China-MSK',
        logisticsMskKzn: 'Logistics MSK-KZN',
        logisticsAdditional: 'Additional Logistics',
        logisticsTotal: 'Total Logistics',
        orderItemCost: 'Item Cost',
        positionsQty: 'Positions Quantity',
        totalQty: 'Total Quantity',
        orderItemWeight: 'Item Weight',
        orderNumberRequired: 'Order number is required',
      },
      deleteConfirm: {
        title: 'Delete Order',
        description: 'Are you sure you want to delete order "{orderNumber}"?',
      },
      errors: {
        createFailed: 'Failed to create order',
        updateFailed: 'Failed to update order',
        deleteFailed: 'Failed to delete order',
      },
    },
    shipments: {
      title: 'Shipments',
      description: 'Marketplace shipments management',
      addShipment: 'Add Shipment',
      editShipment: 'Edit Shipment',
      searchPlaceholder: 'Search shipments...',
      emptyMessage: 'No shipments found',
      table: {
        shipmentNumber: 'Shipment Number',
        store: 'Store',
        warehouse: 'Warehouse',
        status: 'Status',
        shipmentDate: 'Shipment Date',
        sentAccepted: 'Sent / Accepted',
        logistics: 'Logistics',
      },
      form: {
        shipmentNumber: 'Shipment Number',
        store: 'Store',
        warehouse: 'Warehouse',
        status: 'Status',
        shipmentDate: 'Shipment Date',
        acceptanceDate: 'Acceptance Date',
        logisticsCost: 'Logistics Cost',
        unitLogistics: 'Unit Logistics',
        acceptanceCost: 'Acceptance Cost',
        positionsQty: 'Positions Quantity',
        sentQty: 'Sent',
        acceptedQty: 'Accepted',
      },
      deleteConfirm: {
        title: 'Delete Shipment',
        description: 'Are you sure you want to delete shipment "{shipmentNumber}"?',
      },
      errors: {
        createFailed: 'Failed to create shipment',
        updateFailed: 'Failed to update shipment',
        deleteFailed: 'Failed to delete shipment',
      },
    },
    inventoryAdjustments: {
      title: 'Inventory Adjustments',
      description: 'Inventory and stock adjustment management',
      addAdjustment: 'New Adjustment',
      editAdjustment: 'Edit Adjustment',
      searchPlaceholder: 'Search adjustments...',
      emptyMessage: 'No adjustments found',
      table: {
        number: '#',
        adjustmentDate: 'Adjustment Date',
        status: 'Status',
        receipt: 'Receipt',
        writeOff: 'Write-off',
        notes: 'Notes',
        createdAt: 'Created',
      },
      form: {
        adjustmentDate: 'Adjustment Date',
        status: 'Status',
        notes: 'Notes',
      },
      deleteConfirm: {
        title: 'Delete Adjustment',
        description: 'Are you sure you want to delete this adjustment? This action cannot be undone.',
      },
      errors: {
        createFailed: 'Failed to create adjustment',
        updateFailed: 'Failed to update adjustment',
        deleteFailed: 'Failed to delete adjustment',
      },
    },
    settings: {
      title: 'Settings',
      user: {
        title: 'User Information',
        email: 'Email',
        name: 'Name',
        surname: 'Surname',
        role: 'Role',
      },
      appearance: {
        title: 'Appearance',
        theme: 'Theme',
        themeLight: 'Light',
        themeDark: 'Dark',
        language: 'Language',
        languageRu: 'Русский',
        languageEn: 'English',
      },
      notifications: {
        title: 'Notifications',
        description: 'Show notifications for important events',
      },
      logout: 'Logout',
      logoutConfirm: 'Are you sure you want to logout?',
    },
    users: {
      title: 'Users',
      description: 'Manage users and roles',
      addUser: 'Add User',
      editUser: 'Edit User',
      searchPlaceholder: 'Search users...',
      emptyMessage: 'No users found',
      stats: {
        totalUsers: 'Total Users',
        administrators: 'Administrators',
        standardUsers: 'Standard Users',
      },
      table: {
        user: 'User',
        role: 'Role',
      },
      form: {
        email: 'Email',
        password: 'Password',
        passwordHint: 'Minimum 6 characters',
        passwordChangeHint: 'Leave empty to keep current password',
        role: 'Role',
        selectRole: 'Select role',
        name: 'Name',
        surname: 'Surname',
        patronymic: 'Patronymic',
      },
      deleteConfirm: {
        title: 'Delete User',
        description: 'Are you sure you want to delete user "{name}"? This action cannot be undone.',
      },
      errors: {
        requiredFields: 'Please fill in required fields',
        passwordRequired: 'Password is required for new user',
        passwordMinLength: 'Password must be at least 6 characters',
        invalidEmail: 'Invalid email format',
        createFailed: 'Failed to create user',
        updateFailed: 'Failed to update user',
        deleteFailed: 'Failed to delete user',
      },
    },
  },
};

const I18nContext = createContext({
  language: 'ru',
  setLanguage: () => {},
  t: (key) => key,
});

export function I18nProvider({ children }) {
  const [language, setLanguageState] = useState(() => {
    return localStorage.getItem('language') || 'ru';
  });

  useEffect(() => {
    localStorage.setItem('language', language);
  }, [language]);

  const setLanguage = (lang) => {
    if (lang !== language) {
      setLanguageState(lang);
    }
  };

  const t = (key, params = {}) => {
    const keys = key.split('.');
    let value = translations[language];
    for (const k of keys) {
      value = value?.[k];
    }
    if (typeof value !== 'string') {
      return key;
    }
    if (Object.keys(params).length > 0) {
      return value.replace(/\{(\w+)\}/g, (match, paramKey) => {
        return params[paramKey] !== undefined ? params[paramKey] : match;
      });
    }
    return value || key;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  return useContext(I18nContext);
}
